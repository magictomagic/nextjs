<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Linux0</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="backup-and-restore">Backup and Restore</h1>
<p>thanks to <a href="http://zuyunfei.com/2015/06/04/linux-dd/">article1</a>, <a href="https://blog.csdn.net/xtggbmdk/article/details/82706380">article2</a> <strong>Waring:</strong> <code>dd</code> will overload that disk you allocated before <code>mount</code> just modify the img file <strong>Assert:</strong> :D Success on VMware(save time) should be the same as which on Real Bare Machine</p>
<h2 id="vmware">VMware</h2>
<p><strong>If it comes to Boot on LiveCD:</strong> choose <code>use iso image file</code> in <code>CD/DVD(SATA)</code> (I use Ubuntu. Tails or others distributions may also works) click <code>connect at power on</code> <code>power</code> -&gt; <code>power on to firmware</code> -&gt; <code>cd-rom first</code></p>
<h3 id="backup">Backup</h3>
<ol>
<li><p>Whole disk</p>
<p><strong>Make compressed img:</strong> <code>dd if=/dev/sda | gzip &gt; /path to usb/disk.img.gz</code> Warning: Do not set path on current Linux disk or else the size of disk.img would be infinite <strong>Make uncompressed img:</strong> <code>dd if=/dev/sda of=/path to usb/disk.img</code> Warning: Do not use disk based on magnetic and turntable, it takes me more than 12 hours but dumped less than 30G to dd 100G sda to disk.img</p></li>
<li><p>Partial disk</p>
<ol>
<li><p>By Calculate</p>
<p>use <code>lsblk</code> or <code>gparted</code> to check disk content <code>bs*count/1024=x(kb)</code> should bigger than fdisk命令中最大的end数, if your content near and less than 30G: <code>dd bs=512 count=62914560 if=/dev/sda of=/path to disk/back.img</code></p></li>
</ol></li>
</ol>
<h3 id="create-new-mechine-in-vmware">Create new mechine in VMware</h3>
<p><strong>Requirements on Disk to Restore:</strong> disk must bigger than initial .img file use corresponding distrubution set usb compatibility to USB 3.1</p>
<h3 id="restore">Restore</h3>
<ol>
<li><p>Boot on LiveCD</p>
<p>The first step</p></li>
<li><p>By Compressed file</p>
<p><code>gzip -dc /path to usb/disk.img.gz | dd of=/dev/sda</code></p></li>
<li><p>By Uncompressed file</p>
<p><code>dd if=/path to usb/disk.img of=/dev/sda</code></p></li>
<li><p>Check success</p>
<p>Remember to exit, choose <code>Use physical drive, Auto detect</code>, unclick <code>Connect at power on</code>, power on and enter your Restored Linux system Rearrange your partition</p></li>
</ol>
<h2 id="bare-machine">Bare Machine</h2>
<h3 id="backup-1">Backup</h3>
<p>both backup the whole disk and partial disk</p>
<h3 id="restore-1">Restore</h3>
<p>wish never use it:</p>
<h2 id="make-livecd"><span class="todo TODO">TODO</span> Make LiveCD</h2>
<p>Ubuntu can refer to <a href="https://help.ubuntu.com/community/LiveCD/Persistence">link1</a> and <a href="https://help.ubuntu.com/community/LiveCD">link2</a> to make Persistent Storage. But as to liveCD(Live Kit) use <a href="https://github.com/Tomas-M/linux-live">tools</a> to <a href="https://www.linux-live.org/">make your own linux distribution</a>.</p>
<h2 id="become-a-spy-from-scratch">Become a spy from scratch</h2>
<p>I failed on modifying the img file of tails 4.20 by booting it in livecd but success on mounting encrypted disk via tails. Follow the <a href="https://tails.boum.org/doc/advanced_topics/persistence/check_file_system/">link</a> and plug another usb disk, but remember to DELETE the partiton first so that you can use LUKS. Everytime you want to have the premise to mount the encrypted have you to go to the Utilities-&gt;Disks and enter the password.</p>
<h2 id="mountrun-the-system-maybe-by-chroot-or-other-methods-later">mount(Run the System maybe by chroot or other methods later)</h2>
<p>copy from <a href="https://www.linuxquestions.org/questions/linux-general-1/how-to-mount-img-file-882386/">link</a>, tail.img, ubuntu.img(make by dd) both work. The .img files are not images of a partition, but of a whole disk. That means they start with a bootloader and a partition table. You have to find out the offset of the partition and mount it with the offset option of mount. If you do a Code: <code>fdisk -l /path/to/image</code> it will show you the block-size and the start-block of the partition. You can use that to calculate the offset. For example, I have an image of a bootable stick with a 4GB FAT32 partition. The output of the fdisk command is Code:</p>
<p>So I have a block-size of 512 bytes and the start-block is 128. The offset is 512 * 128 = 65536. So the mount command would be Code: <code>mount -o loop,offset=65536 Stick.img /mnt/tmp</code> <code>umount /mnt/tmp/</code> in different directory</p>
<h3 id="chroot-or-other-methods"><span class="todo TODO">TODO</span> Chroot or other methods</h3>
<p>mount, chroot ubuntu.img to see if I can use Rime, Chrome and others</p>
<h1 id="resize-disk">Resize disk</h1>
<p>thanks to <a href="https://www.howtogeek.com/114503/how-to-resize-your-ubuntu-partitions/">article</a></p>
<h2 id="shrink-disk">shrink disk</h2>
<p><strong>Sucess both on VMware and Bare Machine</strong> backup boot on livecd(safe graphics) gparted</p>
<h1 id="shell">shell</h1>
<h2 id="basic-operation">basic operation</h2>
<p>ctrl+alt+t是打开一个terminal ctrl+d关闭一个terminal</p>
<p>打开terminal之后使用ctrl+shift+t是在terminal中打开多个标签</p>
<p>在多个标签中切换的方法： alt+1 alt+2 alt+3……</p>
<p>source 脚本名，是在當前shell環境下執行。 sh 脚本名，是通過建立子shell環境並進行執行。(不影响当前的shell环境（上下文）) vim 下 :source % 加载激活当前环境，有些系统需要 :w 一下</p>
<p>zsh切换bash bash切换zsh 切换bash chsh -s /bin/bash 切换zsh chsh -s /bin/zsh 关闭终端后才有效</p>
<h2 id="bind-common-commands-to-shotcut"><span class="todo TODO">TODO</span> bind common commands to shotcut</h2>
<p>thanks to <a href="https://stackoverflow.com/questions/4200800/in-bash-how-do-i-bind-a-function-key-to-a-command">link1</a>, <a href="https://unix.stackexchange.com/questions/89622/how-to-execute-a-script-in-shell-when-a-shortcut-key-is-pressed">link2</a></p>
<h1 id="tools">Tools</h1>
<h2 id="rsync">rsync</h2>
<p>local &lt;-&gt; remote 增量备份</p>
<h1 id="waiting-花里胡哨">WAITING 花里胡哨</h1>
<p>GNOME Shell GNOME Tweaks GNOME Extensions</p>
</body>
</html>
